<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Verify Access</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

</head>

<body style="font-family:sans-serif;text-align:center;margin-top:60px">

<h2>Manual Verification</h2>
<p>Enter your Discord username to request access</p>

<input id="username" placeholder="example: kasim#0001"
style="padding:10px;width:250px">

<br><br>

<button onclick="sendVerify()" style="padding:10px 20px">
Verify
</button>

<p id="msg"></p>

<script>

/* ========= CONFIG ========= */

const SUPABASE_URL="https://xbwgottrnhubmpxhvkrk.supabase.co";
const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhid2dvdHRybmh1Ym1weGh2a3JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MzI2NzMsImV4cCI6MjA4NzMwODY3M30.EBKwVxdzCtVv9P_S7-IFs1V-NeXRwhuFAL6FUNBEsvk";

const SUPPORT_WEBHOOK="https://discord.com/api/webhooks/1475502488781066320/PIDgCylGmkhnfIJlAFkm9CM13eSYuN03qPefXWjGWS6qMCnk1WI_ygekJY8FfqV4mYUC";
const LOG_WEBHOOK="https://discord.com/api/webhooks/1475502367402233996/9tyecTFCmYzrh4MI9QFIFUzSmu_fpFio2lIPbWv-FfFR9HmtcCgRISI05omfkA1apAe-";

/* ========= SUPABASE ========= */

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* ========= VERIFY ========= */

async function sendVerify(){

const username=document.getElementById("username").value.trim();

if(!username){
document.getElementById("msg").innerText="Enter username first";
return;
}

const user=JSON.parse(localStorage.getItem("discordUser"));

if(!user){
alert("Login first");
location.href="index.html";
return;
}

/* SAVE VERIFIED IN DATABASE */

const {error}=await supabase
.from("users")
.upsert([{
id:user.id,
name:username,
verified:true
}]);

if(error){
console.error(error);
document.getElementById("msg").innerText="Database error";
return;
}

/* SEND DISCORD WEBHOOKS */

fetch(SUPPORT_WEBHOOK,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
content:`ðŸŸ¢ VERIFY REQUEST\nUser: ${username}\nID: ${user.id}`
})
});

fetch(LOG_WEBHOOK,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
content:`ðŸ“Œ User verified on website: ${username}`
})
});

/* MARK LOCAL VERIFIED */

localStorage.setItem("verifiedUser","true");

document.getElementById("msg").innerText="âœ… Verified! Redirecting...";

setTimeout(()=>{
location.href="dashboard.html";
},1200);

}

</script>

</body>
</html>
