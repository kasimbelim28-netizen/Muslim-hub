<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
</head>

<body style="background:#020617;color:white;text-align:center;font-family:sans-serif;padding-top:60px">

<h2 id="msg">Processing login...</h2>

<script>

// ----- GET TOKEN FROM DISCORD REDIRECT -----
const hash = window.location.hash;

if(hash){

  const params = new URLSearchParams(hash.slice(1));
  const token = params.get("access_token");

  if(token){
    localStorage.setItem("discord_token", token);

    // remove token from URL instantly
    window.location.replace("dashboard.html");
  }

}

// ----- LOAD TOKEN -----
const savedToken = localStorage.getItem("discord_token");

if(!savedToken){
  document.getElementById("msg").innerText="Not logged in. Go back and login.";
}else{

// ----- GET USER FROM DISCORD -----
fetch("https://discord.com/api/users/@me",{
headers:{Authorization:"Bearer "+savedToken}
})
.then(r=>r.json())
.then(user=>{

// if Discord returned error
if(user.message){
throw "bad token";
}

document.body.innerHTML=`
<h1>Welcome ${user.username}</h1>

<img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png"
width="120" style="border-radius:50%;margin-top:15px">

<p>ID: ${user.id}</p>

<br><br>

<button onclick="logout()" style="
padding:12px 20px;
border:none;
border-radius:8px;
background:#ef4444;
color:white;
cursor:pointer">
Logout
</button>
`;

})
.catch(()=>{

localStorage.removeItem("discord_token");

document.getElementById("msg").innerText=
"Login failed. Please go back and try again.";

});

}

function logout(){
localStorage.removeItem("discord_token");
location.href="index.html";
}

</script>

</body>
</html>
