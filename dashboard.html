<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
body{background:#0a0f1c;color:white;font-family:sans-serif;margin:0}
.topbar{display:flex;justify-content:space-between;padding:18px;background:#0f1428}
.btn{padding:10px 16px;border:none;border-radius:8px;cursor:pointer}
.support{background:#1d4ed8;color:white}
.admin{background:#111827;color:white}
.discord{background:#5865F2;color:white}
.main{padding:30px}
.card{background:#111827;padding:20px;border-radius:12px;margin-bottom:20px}
#adminArea{position:fixed;bottom:20px;right:20px;background:#020617;padding:15px;border-radius:10px;display:none}
#supportBox textarea{width:260px;height:90px;border-radius:8px;border:none;padding:8px}
</style>
</head>

<body>

<div class="topbar">
<div>ULTRA DASHBOARD</div>

<div>
<button class="btn support" onclick="openSupport()">Support</button>
<button class="btn admin" onclick="adminToggle()">Admin</button>
<button class="btn discord" onclick="window.open('https://discord.gg/ATzJaBh3xk')">Discord</button>
</div>
</div>

<div class="main">
<div class="card">
<h3>Account</h3>
<p id="accountInfo">Checking login...</p>
</div>
</div>

<div id="supportBox" style="display:none;background:#020617;padding:20px;border-radius:10px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)">
<h3>Support</h3>
<textarea id="supportText" placeholder="Describe your issue"></textarea><br><br>
<button onclick="generateSupport()">Send</button>
<button onclick="closeSupport()">Close</button>
<p id="supportOutput"></p>
</div>

<div id="adminArea">
<input id="cmdBox" placeholder="Type command">
<button onclick="runCmd()">Run</button>
<div id="output"></div>
</div>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

/* ========= SUPABASE ========= */

const SUPABASE_URL="https://xbwgottrnhubmpxhvkrk.supabase.co";
const SUPABASE_ANON="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhid2dvdHRybmh1Ym1weGh2a3JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MzI2NzMsImV4cCI6MjA4NzMwODY3M30.EBKwVxdzCtVv9P_S7-IFs1V-NeXRwhuFAL6FUNBEsvk";

const supabase=createClient(SUPABASE_URL,SUPABASE_ANON);

/* ========= WEBHOOKS ========= */

const SUPPORT_WEBHOOK="https://discord.com/api/webhooks/1475502488781066320/PIDgCylGmkhnfIJlAFkm9CM13eSYuN03qPefXWjGWS6qMCnk1WI_ygekJY8FfqV4mYUC";
const LOG_WEBHOOK="https://discord.com/api/webhooks/1475502367402233996/9tyecTFCmYzrh4MI9QFIFUzSmu_fpFio2lIPbWv-FfFR9HmtcCgRISI05omfkA1apAe-";
const OWNER_ID="1473632317112189062";

/* ========= WEBHOOK HELPERS ========= */

function sendWebhook(url,msg){
fetch(url,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({content:msg})
}).catch(()=>{});
}

function logLogin(name){
if(sessionStorage.getItem("loginLogged")) return;
sessionStorage.setItem("loginLogged","1");
sendWebhook(LOG_WEBHOOK,`ðŸŸ¢ Login:\n${name} Logged to the website!`);
}

function logError(problem){
sendWebhook(LOG_WEBHOOK,`ðŸ”´ Error:\n${problem}\n<@${OWNER_ID}>`);
}

function sendSupportMsg(name,text){
sendWebhook(SUPPORT_WEBHOOK,
`ðŸŸ¡ Support Request\nUser: ${name}\nMessage: "${text}"`);
}

window.onerror=function(msg,src,line){
logError(msg+" at line "+line);
};

/* ========= LOAD USER ========= */

(async function(){

const user=JSON.parse(localStorage.getItem("discordUser")||"null");

if(!user){
location.href="index.html";
return;
}

/* SAVE USER */
await supabase.from("users").upsert([{
id:user.id,
name:user.username
}]);


/* CHECK VERIFIED */
const {data}=await supabase
.from("users")
.select("verified")
.eq("id",user.id)
.single();

if(!data || !data.verified){
location.href="verify.html";
return;
}

/* SHOW ACCOUNT */
document.getElementById("accountInfo").innerText=
"Logged in as "+user.username+"#"+user.discriminator;

logLogin(user.username);

/* ADMIN */
if(user.id===OWNER_ID){
document.querySelector(".admin").style.display="inline-block";
}else{
document.querySelector(".admin").style.display="none";
}

})();

/* ========= SUPPORT ========= */

window.openSupport=function(){
document.getElementById("supportBox").style.display="block";
}

window.closeSupport=function(){
document.getElementById("supportBox").style.display="none";
}

window.generateSupport=function(){

let t=document.getElementById("supportText").value.trim();
if(!t)return alert("Write something");

let user=JSON.parse(localStorage.getItem("discordUser")||"null");
let name=user?.username||"Unknown";

document.getElementById("supportOutput").innerText="Sent!";
sendSupportMsg(name,t);

}

/* ========= ADMIN ========= */

window.adminToggle=function(){
document.getElementById("adminArea").style.display="block";
}

window.runCmd=function(){

let cmd=document.getElementById("cmdBox").value.trim();
let output=document.getElementById("output");

if(cmd==="?lockweb"){
localStorage.setItem("siteLocked","true");
location.reload();
}

else if(cmd==="?unlockweb"){
localStorage.removeItem("siteLocked");
location.reload();
}

else if(cmd.startsWith("?playsong")){
let id=cmd.split(" ")[1];
if(!id)return alert("Use ?playsong VIDEO_ID");

output.innerHTML=
`<iframe width="250" height="140"
src="https://www.youtube.com/embed/${id}"
allowfullscreen></iframe>`;
}

else if(cmd==="?checkallusersaccount"){
output.innerText=localStorage.getItem("discordUser")||"none";
}

else alert("Unknown command");

}

</script>

</body>
</html>
